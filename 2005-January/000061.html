<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [ircbp-commits] IRCBP -  r66 - bot/trunk
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/ircbp-commits/2005-January/index.html" >
   <LINK REL="made" HREF="mailto:ircbp-commits%40lists.berlios.de?Subject=Re%3A%20%5Bircbp-commits%5D%20IRCBP%20-%20%20r66%20-%20bot/trunk&In-Reply-To=%3C200501150859.j0F8xs5T009455%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000060.html">
   <LINK REL="Next"  HREF="000062.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[ircbp-commits] IRCBP -  r66 - bot/trunk</H1>
    <B>nigelj at berlios.de</B> 
    <A HREF="mailto:ircbp-commits%40lists.berlios.de?Subject=Re%3A%20%5Bircbp-commits%5D%20IRCBP%20-%20%20r66%20-%20bot/trunk&In-Reply-To=%3C200501150859.j0F8xs5T009455%40sheep.berlios.de%3E"
       TITLE="[ircbp-commits] IRCBP -  r66 - bot/trunk">nigelj at berlios.de
       </A><BR>
    <I>Sat Jan 15 09:59:54 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000060.html">[ircbp-commits] IRCBP -  r65 - framework/trunk
</A></li>
        <LI>Next message: <A HREF="000062.html">[ircbp-commits] IRCBP -  r67 - bot/trunk framework/trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61">[ date ]</a>
              <a href="thread.html#61">[ thread ]</a>
              <a href="subject.html#61">[ subject ]</a>
              <a href="author.html#61">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: nigelj
Date: 2005-01-15 09:59:52 +0100 (Sat, 15 Jan 2005)
New Revision: 66

Modified:
   bot/trunk/CHANGELOG
   bot/trunk/ircbp.py
   bot/trunk/ircbpcommon.py
   bot/trunk/ircbpconfig.py
Log:
06/01/05 - nigelj
* Cleaned CHANGELOG

07/01/05 - nigelj
* Fixed imports in ircbpcommon.py

15/01/05 - nigelj
* Extending the lists (SQL update to come shortly)
* Making privcheck(ircbpcommon.py) more advanced and using flag levels
* Simplified the SQL Queries again
* Made all the privcheck calls ask for certain levels...


Modified: bot/trunk/CHANGELOG
===================================================================
--- bot/trunk/CHANGELOG	2005-01-15 07:52:40 UTC (rev 65)
+++ bot/trunk/CHANGELOG	2005-01-15 08:59:52 UTC (rev 66)
@@ -1,163 +1,15 @@
 # Change Log - Format to be decided
 # Dates are in GMT and in DD/MM/YY format
+# Changes made on the Framework components that are copied here will not be logged
 
-NJ - 30/09/04 - Various work on core code.
-NJ - 01/10/04 - Added quite a few comments to the source code.
-NJ - 01/10/04 - Removed some old code + made the source format look prettier! (looks good on a 8-COL Tab Text Editor)
-NJ - 01/10/04 - Added more if's to check that we are not tring to access non existant data!
-NJ - 01/10/04 - Had some empty else's in the source, caused some runtime problems, fixed that.
-NJ - 01/10/04 - Add some Privledge checking because well truth be told AppleBoy was starting to semi-annoy me by using the !kick command when I didn't want him to.  Will be replaced by Pankey's system soon.
-NJ - 01/10/04 - Implementing Changelog and used SVN History to create past events.
-NJ - 01/10/04 - Starting a system like the Privledge system to join Multiple Channels.
-NJ - 01/10/04 - Channel System is done, needs lots of testing.  I think i'll leave programming at that for now.
-NJ - 01/10/04 - Added !join, no !part yet.
-NJ - 01/10/04 - Added privcheck call to: !topic, !quit and !cycle
-NJ - 01/10/04 - Made syntax errors have a bit of bold.
-NJ - 01/10/04 - Made !kick run as a multichannel system, e.g. !kick &lt;channel&gt; &lt;nick&gt; [messsage]
-BP - 02/10/04 - Made authorization more secure
-NJ - 02/10/04 - Added pankeys changelog entry for him
-NJ - 02/10/04 - Fixed Bug #2557 (IndexError: list index out of range - KICK)
-NJ - 02/10/04 - Importing Python module &quot;fnmatch&quot; - seems a nifty feature for wildcards etc
-NJ - 02/10/04 - Deleting masks_ircbp.py - the system has some flaws etc.
-NJ - 02/10/04 - Added new hostmask system, I KNOW ANOTHER ONE! - This one works a DREAM! - Uses fnmatch which I added to the imports, for a FS Matching checker it works SUPER well on plain text!
-NJ - 02/10/04 - Fixed bug #2556 (Comparing strings may fail because of case)
-NJ - 03/10/04 - Added more comments so that it's more spaced out where the !say commands are etc
-NJ - 03/10/04 - Started to implement the ability to have multiple prefixes, sadly i realised that my way of checking will cause problems.  The call for it has being commented out and put back to the original but it is something we should look at making better in the future.
-BP - 03/10/04 - Added a bash script to copy unix files to windows .txt format =)
-BP - 03/10/04 - Added !part command...realized this ChangeLog is backwards...should be top with newest changes
-NJ - 09/10/04 - Added the python interpreter line to top of ircbp.py
-NJ - 09/10/04 - Made the configuration stuff bit better to look at!
-NJ - 09/10/04 - Made some code more &quot;tidy&quot;
-NJ - 09/10/04 - RELEASE - 0.1.0
-NJ - 09/10/04 - Tag to /framework/tags/REL-0.1.0
-NJ - 09/10/04 - Added a temporary README
-NJ - 09/10/04 - Made REALNAME set by default to fix bug #2613 (Invalid IRC Parameters)
-NJ - 10/10/04 - Made irclogin() much more simple
-NJ - 10/10/04 - Added sendnickserv() so users can have their bot automatically identify to nickserv
-NJ - 13/11/04 - Added remchan() to reverse addchan()
-NJ - 13/11/04 - Added !list as a debugging tool (list channels the bot is on)
-NJ - 13/11/04 - Fixed !part to fix bug #2614 (!part Parts the wrong channel)
-NJ - 13/11/04 - Added ircbpconfig.py
-NJ - 13/11/04 - All the &quot;lists&quot; (I call them arrays) are now held in the new module.
-NJ - 13/11/04 - README fixed up.
-NJ - 13/11/04 - Added svn:ignore *.pyc because we don't need to import compiled python modules into the repo)
-NJ - 13/11/04 - Found a problem with all the commands, it was checking for NICKNAME instead of ircbpconfig.NICKNAME
-NJ - 13/11/04 - Cleaned up some debug stuff I added when I was having trouble with the module.
-NJ - 13/11/04 - Added &quot;DANCERMODE&quot; so we can seperate Dancer only behaviour.  Planning to do this for other IRCds.
-NJ - 13/11/04 - Bot now supports DancerIRCd forwarding.  Fixes bug #2782 (Bot doesn't follow Dancer Forwarding)
-NJ - 14/11/04 - Added new lines to ircbpconfig.py
-NJ - 14/11/04 - Added checking for 'join-blocking' numerics
-NJ - 14/11/04 - Made handling for 'join-blocking' numerics check if that was the last channel, if so it will quit cleaning fixing bug #2781 (Bot doesn't phase RAW messages)
-NJ - 14/11/04 - Added the DancerIRCd 'join-blocking' numerics
-NJ - 14/11/04 - Fixed some of the tabbing
-NJ - 14/11/04 - Fix a TINY bug... (I added a '.' after a function and python didn't like it.
-NJ - 14/11/04 - Made the bot rejoin when kicked.
-NJ - 14/11/04 - Updated mktxt.sh (so it will make README.txt
-NJ - 14/11/04 - Got rid of the .txt files as we can just mktxt them for releases (e.g. Windows users that are able to download source from SVN should be able to read these files via open with)
-NJ - 14/11/04 - RELEASE - 0.1.1
-NJ - 14/11/04 - Tag to /framework/tags/REL-0.1.1
-NJ - 15/11/04 - Started implementing SQL to the bot.
-NJ - 15/11/04 - Worked out a config table system
-NJ - 15/11/04 - Implemented all the DB calls but have not yet got a NSPASSWD coloum in yet...
-NJ - 16/11/04 - Add mysql table create file...
-NJ - 16/11/04 - Somehow an IF statement got replaced with &quot;hey&quot; so it wouldn't work :(
-NJ - 16/11/04 - After advise all the tabs have being removed
-NJ - 05/12/04 - Updating the newline handling in the buffer thanks to bdash in #newzealand on freenode ;)
-NJ - 05/12/04 - Finished updating the newline handling (it works perfectly) once again, THANK YOU BDASH!
-NJ - 05/12/04 - Fix up !kick syntax error.
-NJ - 06/12/04 - Added NSPASSWORD to SQL
-NJ - 06/12/04 - Made a small optimization in ircbpconfig.py to incorporate the DB handling to end result into 1 line (instead of two) and only two varibles, looking for more to be made currently.
-NJ - 06/12/04 - Remade create_config.sql (this time from phpMyAdmin).  Now also drops existing table (if any) so PLEASE watch out!
-NJ - 06/12/04 - Limited SQL query to one result which should prevent problems.
-NJ - 07/12/04 - 433 numeric now handled - means that it append a _ to ircbpconfig.NICKNAME and send a NICK command to the server until it is allowed
-NJ - 07/12/04 - 376 numeric now handled - When the server gets the 376 (END OF MOTD) numeric it will THEN send Nickserv Identification and Join requested channels.
-NJ - 07/12/04 - Implemented db-based channels and users to the bot.
-NJ - 07/12/04 - Fixed comments in ircbpconfig.py (to make it clearer in the fact you only need to edit the SQL settings now).
-BP - 07/12/04 - Fixed some spacing and such. Mostly code browsing since i need (and dont have) _mysql for the bot to work  =P
-NJ - 06/01/04 - Modulized common functions into ircbpcommon.py
-NJ - 06/01/04 - Added error handing to mysql (rough for now)
-NJ - 06/01/04 - Moved socket stuff so not much is left in ircbp.py
-=======
-# Change Log - Format to be decided
-# Dates are in GMT and in DD/MM/YY format
+06/01/05 - nigelj
+* Cleaned CHANGELOG
 
-NJ - 30/09/04 - Various work on core code.
-NJ - 01/10/04 - Added quite a few comments to the source code.
-NJ - 01/10/04 - Removed some old code + made the source format look prettier! (looks good on a 8-COL Tab Text Editor)
-NJ - 01/10/04 - Added more if's to check that we are not tring to access non existant data!
-NJ - 01/10/04 - Had some empty else's in the source, caused some runtime problems, fixed that.
-NJ - 01/10/04 - Add some Privledge checking because well truth be told AppleBoy was starting to semi-annoy me by using the !kick command when I didn't want him to.  Will be replaced by Pankey's system soon.
-NJ - 01/10/04 - Implementing Changelog and used SVN History to create past events.
-NJ - 01/10/04 - Starting a system like the Privledge system to join Multiple Channels.
-NJ - 01/10/04 - Channel System is done, needs lots of testing.  I think i'll leave programming at that for now.
-NJ - 01/10/04 - Added !join, no !part yet.
-NJ - 01/10/04 - Added privcheck call to: !topic, !quit and !cycle
-NJ - 01/10/04 - Made syntax errors have a bit of bold.
-NJ - 01/10/04 - Made !kick run as a multichannel system, e.g. !kick &lt;channel&gt; &lt;nick&gt; [messsage]
-BP - 02/10/04 - Made authorization more secure
-NJ - 02/10/04 - Added pankeys changelog entry for him
-NJ - 02/10/04 - Fixed Bug #2557 (IndexError: list index out of range - KICK)
-NJ - 02/10/04 - Importing Python module &quot;fnmatch&quot; - seems a nifty feature for wildcards etc
-NJ - 02/10/04 - Deleting masks_ircbp.py - the system has some flaws etc.
-NJ - 02/10/04 - Added new hostmask system, I KNOW ANOTHER ONE! - This one works a DREAM! - Uses fnmatch which I added to the imports, for a FS Matching checker it works SUPER well on plain text!
-NJ - 02/10/04 - Fixed bug #2556 (Comparing strings may fail because of case)
-NJ - 03/10/04 - Added more comments so that it's more spaced out where the !say commands are etc
-NJ - 03/10/04 - Started to implement the ability to have multiple prefixes, sadly i realised that my way of checking will cause problems.  The call for it has being commented out and put back to the original but it is something we should look at making better in the future.
-BP - 03/10/04 - Added a bash script to copy unix files to windows .txt format =)
-BP - 03/10/04 - Added !part command...realized this ChangeLog is backwards...should be top with newest changes
-NJ - 09/10/04 - Added the python interpreter line to top of ircbp.py
-NJ - 09/10/04 - Made the configuration stuff bit better to look at!
-NJ - 09/10/04 - Made some code more &quot;tidy&quot;
-NJ - 09/10/04 - RELEASE - 0.1.0
-NJ - 09/10/04 - Tag to /framework/tags/REL-0.1.0
-NJ - 09/10/04 - Added a temporary README
-NJ - 09/10/04 - Made REALNAME set by default to fix bug #2613 (Invalid IRC Parameters)
-NJ - 10/10/04 - Made irclogin() much more simple
-NJ - 10/10/04 - Added sendnickserv() so users can have their bot automatically identify to nickserv
-NJ - 13/11/04 - Added remchan() to reverse addchan()
-NJ - 13/11/04 - Added !list as a debugging tool (list channels the bot is on)
-NJ - 13/11/04 - Fixed !part to fix bug #2614 (!part Parts the wrong channel)
-NJ - 13/11/04 - Added ircbpconfig.py
-NJ - 13/11/04 - All the &quot;lists&quot; (I call them arrays) are now held in the new module.
-NJ - 13/11/04 - README fixed up.
-NJ - 13/11/04 - Added svn:ignore *.pyc because we don't need to import compiled python modules into the repo)
-NJ - 13/11/04 - Found a problem with all the commands, it was checking for NICKNAME instead of ircbpconfig.NICKNAME
-NJ - 13/11/04 - Cleaned up some debug stuff I added when I was having trouble with the module.
-NJ - 13/11/04 - Added &quot;DANCERMODE&quot; so we can seperate Dancer only behaviour.  Planning to do this for other IRCds.
-NJ - 13/11/04 - Bot now supports DancerIRCd forwarding.  Fixes bug #2782 (Bot doesn't follow Dancer Forwarding)
-NJ - 14/11/04 - Added new lines to ircbpconfig.py
-NJ - 14/11/04 - Added checking for 'join-blocking' numerics
-NJ - 14/11/04 - Made handling for 'join-blocking' numerics check if that was the last channel, if so it will quit cleaning fixing bug #2781 (Bot doesn't phase RAW messages)
-NJ - 14/11/04 - Added the DancerIRCd 'join-blocking' numerics
-NJ - 14/11/04 - Fixed some of the tabbing
-NJ - 14/11/04 - Fix a TINY bug... (I added a '.' after a function and python didn't like it.
-NJ - 14/11/04 - Made the bot rejoin when kicked.
-NJ - 14/11/04 - Updated mktxt.sh (so it will make README.txt
-NJ - 14/11/04 - Got rid of the .txt files as we can just mktxt them for releases (e.g. Windows users that are able to download source from SVN should be able to read these files via open with)
-NJ - 14/11/04 - RELEASE - 0.1.1
-NJ - 14/11/04 - Tag to /framework/tags/REL-0.1.1
-NJ - 15/11/04 - Started implementing SQL to the bot.
-NJ - 15/11/04 - Worked out a config table system
-NJ - 15/11/04 - Implemented all the DB calls but have not yet got a NSPASSWD coloum in yet...
-NJ - 16/11/04 - Add mysql table create file...
-NJ - 16/11/04 - Somehow an IF statement got replaced with &quot;hey&quot; so it wouldn't work :(
-NJ - 16/11/04 - After advise all the tabs have being removed
-NJ - 05/12/04 - Updating the newline handling in the buffer thanks to bdash in #newzealand on freenode ;)
-NJ - 05/12/04 - Finished updating the newline handling (it works perfectly) once again, THANK YOU BDASH!
-NJ - 05/12/04 - Fix up !kick syntax error.
-NJ - 06/12/04 - Added NSPASSWORD to SQL
-NJ - 06/12/04 - Made a small optimization in ircbpconfig.py to incorporate the DB handling to end result into 1 line (instead of two) and only two varibles, looking for more to be made currently.
-NJ - 06/12/04 - Remade create_config.sql (this time from phpMyAdmin).  Now also drops existing table (if any) so PLEASE watch out!
-NJ - 06/12/04 - Limited SQL query to one result which should prevent problems.
-NJ - 07/12/04 - 433 numeric now handled - means that it append a _ to ircbpconfig.NICKNAME and send a NICK command to the server until it is allowed
-NJ - 07/12/04 - 376 numeric now handled - When the server gets the 376 (END OF MOTD) numeric it will THEN send Nickserv Identification and Join requested channels.
-NJ - 07/12/04 - Implemented db-based channels and users to the bot.
-NJ - 07/12/04 - Fixed comments in ircbpconfig.py (to make it clearer in the fact you only need to edit the SQL settings now).
-BP - 07/12/04 - Fixed some spacing and such. Mostly code browsing since i need (and dont have) _mysql for the bot to work  =P
-NJ - 06/01/05 - Modulized common functions into ircbpcommon.py
-NJ - 06/01/05 - Added error handing to mysql (rough for now)
-NJ - 06/01/05 - Moved socket stuff so not much is left in ircbp.py
-NJ - 06/01/05 - Fixed missing comment in ircbpcommon.py
-NJ - 06/01/05 - Fixed problem CHANGELOG (3rd time lucky hopefully)
-NJ - 06/01/05 - Changed _mysql to MySQLdb (<A HREF="http://sourceforge.net/projects/mysql-python/">http://sourceforge.net/projects/mysql-python/</A>)
-NJ - 06/01/05 - Spotted new mistake with my changelog entries, it's 05 now not 04 ;)
+07/01/05 - nigelj
+* Fixed imports in ircbpcommon.py
+
+15/01/05 - nigelj
+* Extending the lists (SQL update to come shortly)
+* Making privcheck(ircbpcommon.py) more advanced and using flag levels
+* Simplified the SQL Queries again
+* Made all the privcheck calls ask for certain levels...

Modified: bot/trunk/ircbp.py
===================================================================
--- bot/trunk/ircbp.py	2005-01-15 07:52:40 UTC (rev 65)
+++ bot/trunk/ircbp.py	2005-01-15 08:59:52 UTC (rev 66)
@@ -73,14 +73,18 @@
                 # Say Command
     
                 if string.upper(string.lstrip(msg[3], ':')) == string.upper('!say'):
-                    print &quot;We need to say something :P&quot;
-                    message = ' '.join(msg[4:])
-                    ircbpcommon.irccommand(&quot;PRIVMSG &quot; + CHANNEL + &quot; :&quot; + message)
+                    if ircbpcommon.privcheck(HOSTMASK, &quot;U&quot;):
+                        print &quot;We need to say something :P&quot;
+                        message = ' '.join(msg[4:])
+                        ircbpcommon.irccommand(&quot;PRIVMSG &quot; + CHANNEL + &quot; :&quot; + message)
+                    else:
+                        # They don't have privledges!
+                        ircbpcommon.irccommand(&quot;PRIVMSG &quot; + CHANNEL + &quot; :No privledges for this command!&quot;)
 
                 # Topic Command
 
                 if string.upper(string.lstrip(msg[3], ':')) == string.upper('!topic'):
-                    if ircbpcommon.privcheck(HOSTMASK):
+                    if ircbpcommon.privcheck(HOSTMASK, &quot;O&quot;):
                         if len(msg) &gt; 4:
                             print &quot;Changing Topic&quot;
                             message = ' '.join(msg[4:])
@@ -95,7 +99,7 @@
                 # Kick Command
     
                 if string.upper(string.lstrip(msg[3], ':')) == string.upper('!kick'):
-                    if ircbpcommon.privcheck(HOSTMASK) == 1:
+                    if ircbpcommon.privcheck(HOSTMASK, &quot;O&quot;):
                         print &quot;Someone's being bad, I need to kick!&quot;
                         #if msg[4] != '':
                         if len(msg) &gt; 4:
@@ -132,13 +136,13 @@
                 if string.upper(string.lstrip(msg[3], ':')) == string.upper('!join'):
                     print &quot;Joining a channel!&quot;
                     # Need to make sure that nick_name has in our privledged array
-                    if ircbpcommon.privcheck(HOSTMASK):
+                    if ircbpcommon.privcheck(HOSTMASK, &quot;A&quot;):
                         # He/She is, making sure that they provided a channel - We will need a string check on this too.
                         if len(msg) &gt; 4:
                             # Something has being provided, need to make sure it is a channel for now by only checking if it has # at the start
                             if msg[4][0] == &quot;#&quot;:
                                 # All ok, adding the channel to the array, JOIN sent normally because we have gone past the time of dojoin
-                                ircbpconfig.addchan(msg[4])
+                                ircbpcommon.addchan(msg[4])
                                 ircbpcommon.irccommand(&quot;JOIN &quot; + msg[4])
                             else:
                                 # Not a channel, return error
@@ -152,7 +156,7 @@
 	        # Cycle Command
     
 	        if string.upper(string.lstrip(msg[3], ':')) == string.upper('!cycle'):
-                    if ircbpcommon.privcheck(HOSTMASK):
+                    if ircbpcommon.privcheck(HOSTMASK, &quot;A&quot;):
                         print &quot;Cycling!&quot;
                         ircbpcommon.irccommand(&quot;PRIVMSG &quot; + CHANNEL + &quot; :Okie Doke!&quot;)
                         ircbpcommon.irccommand(&quot;PART &quot; + CHANNEL)
@@ -165,19 +169,19 @@
                 # Part Command
     
                 if string.upper(string.lstrip(msg[3], ':')) == string.upper('!part'):
-                    if ircbpcommon.privcheck(HOSTMASK):
+                    if ircbpcommon.privcheck(HOSTMASK, &quot;A&quot;):
                         if len(msg) &gt; 4:
                             if msg[4][0] == &quot;#&quot;:
                                 print &quot;Parting!&quot;
                                 ircbpcommon.irccommand(&quot;PRIVMSG &quot; + msg[4] + &quot; :buh-bye now! =)&quot;)
                                 ircbpcommon.irccommand(&quot;PART &quot; + msg[4] + &quot; :Part from %s&quot; % nick_name)
-                                remchan(msg[4])
+                                ircbpcommon.remchan(msg[4])
                             else:
                                 ircbpcommon.irccommand(&quot;PRIVMSG &quot; + CHANNEL + &quot; :&quot; + msg[4] + &quot; is not a channel&quot;)
                         else:
                             ircbpcommon.irccommand(&quot;PRIVMSG &quot; + CHANNEL + &quot; :buh-bye now! =)&quot;)
                             ircbpcommon.irccommand(&quot;PART &quot; + CHANNEL + &quot; :Part from %s&quot; % nick_name)
-                            remchan(CHANNEL)
+                            ircbpcommon.remchan(CHANNEL)
                     else:
                         # Oh dear they tried to part our bot!
                         ircbpcommon.irccommand(&quot;PRIVMSG &quot; + CHANNEL + &quot; :No privledges for this command!&quot;)
@@ -185,7 +189,7 @@
                 # Quit Command
     
                 if string.upper(string.lstrip(msg[3], ':')) == string.upper('!quit'):
-                    if ircbpcommon.privcheck(HOSTMASK):
+                    if ircbpcommon.privcheck(HOSTMASK, &quot;A&quot;):
                         print &quot;It's a quit&quot;
                         ircbpcommon.irccommand(&quot;QUIT :Quit from &quot; + nick_name)
                         print &quot;Sent quit message, exiting&quot;
@@ -210,7 +214,7 @@
             #We can't join channels that are invite only
             print &quot;The channel the bot just tried to join is invite only...&quot;
             print &quot;Removing from list&quot;
-            remchan(msg[3])
+            ircbpcommon.remchan(msg[3])
             if len(ircbpconfig.CHANNELS) == 0:
                 print &quot;There has being an error join the IRC Channels that you have provided,  and we cannot proceed.&quot;
                 print &quot;For your convinence the bot has being cleanly shutdown&quot;
@@ -219,14 +223,14 @@
         if ircbpconfig.DANCERMODE:
             if msg[1] == '379':
                 print &quot;We are being forwarded&quot;
-                remchan(msg[3])
+                ircbpcommon.remchan(msg[3])
                 ircbpconfig.addchan(msg[4])
             #join blocking modes
             if msg[1] == '437' or msg[1] == '480' or msg[1] == '515':
                 #We can't join channels that are invite only
                 print &quot;The channel the bot just tried to join is invite only...&quot;
                 print &quot;Removing from list&quot;
-                remchan(msg[3])
+                ircbpcommon.remchan(msg[3])
                 if len(ircbpconfig.CHANNELS) == 0:
                     print &quot;There has being an error join the IRC Channels that you have provided,  and we cannot proceed.&quot;
                     print &quot;For your convinence the bot has being cleanly shutdown&quot;

Modified: bot/trunk/ircbpcommon.py
===================================================================
--- bot/trunk/ircbpcommon.py	2005-01-15 07:52:40 UTC (rev 65)
+++ bot/trunk/ircbpcommon.py	2005-01-15 08:59:52 UTC (rev 66)
@@ -24,7 +24,11 @@
 # GPL Document can also be found in the same directory as this file as &quot;LICENSE&quot;			#
 #########################################################################################################
 
-import socket, string, sys, time, fnmatch
+import socket
+import string
+import sys
+import time
+import fnmatch
 import ircbpconfig
 
 # This basic socket will provide 1 connection to an IRC Server, in future we can most likely make it into an array
@@ -54,8 +58,8 @@
     x = 0
     print &quot;Starting the loop&quot;
     while (len(ircbpconfig.channels)-1 &gt;= x):
-        print &quot;The loop is going to join the channel in ircbpconfig.channels[&quot; + str(x) + &quot;] which is &quot; + ircbpconfig.channels[x]
-        irccommand(&quot;JOIN &quot; + ircbpconfig.channels[x])
+        print &quot;The loop is going to join the channel in ircbpconfig.channels[&quot; + str(x) + &quot;][0] which is &quot; + ircbpconfig.channels[x][0]
+        irccommand(&quot;JOIN &quot; + ircbpconfig.channels[0][0])
         x = x+1
     print &quot;dojoins Complete!&quot;
 
@@ -64,22 +68,35 @@
     if ircbpconfig.NSPASSWORD != &quot;&quot;: 
         irccommand(&quot;PRIVMSG NICKSERV :IDENTIFY &quot; + ircbpconfig.NSPASSWORD)
         time.sleep(10)
+
+def addchan(CHANNEL):
+    ircbpconfig.channels.append(CHANNEL)
         
 # This function will check if a user is in the privledged[x] array
 
-def privcheck(USERHOSTTBC):
+def privcheck(USERHOSTTBC, LEVEL):
     print &quot;User PrivCheck Called&quot;
     x = 0
     print &quot;starting the loop&quot;
     while (len(ircbpconfig.privledged)-1 &gt;= x):
         print &quot;The data we got is: &quot; + USERHOSTTBC
-        print &quot;The loop is checking ircbpconfig.privledged[&quot; + str(x) + &quot;] which is &quot; + ircbpconfig.privledged[x]
-        if fnmatch.fnmatch(USERHOSTTBC,ircbpconfig.privledged[x]):
-            print &quot;OMG MATCH!&quot;
-            return 1
+        print &quot;The loop is checking ircbpconfig.privledged[&quot; + str(x) + &quot;][0] which is &quot; + ircbpconfig.privledged[x][0]
+        if fnmatch.fnmatch(USERHOSTTBC,ircbpconfig.privledged[x][0]):
+            print &quot;We have a match on the host, now to check access&quot;
+            print ircbpconfig.privledged[x][1]
+            if LEVEL == &quot;A&quot; and ircbpconfig.privledged[x][1] == &quot;A&quot;:
+                    return 1
+            elif LEVEL == &quot;O&quot; and ircbpconfig.privledged[x][1] in &quot;AO&quot;:
+                    return 1
+            elif LEVEL == &quot;U&quot; and ircbpconfig.privledged[x][1] in &quot;AOU&quot;:
+                    return 1
+            else:
+                return 0
+                print &quot;Auth Level does not match&quot;
         else:
             x = x+1
             print &quot;NOT A MATCH!&quot;
+            continue
     return 0
     print &quot;No Matches&quot;
 
@@ -90,8 +107,8 @@
     x = 0
     print &quot;Starting the loop&quot;
     while (len(ircbpconfig.channels)-1 &gt;= x):
-        print &quot;The loop is checking if we are in ircbpconfig.channels[&quot; + str(x) + &quot;] which is &quot; + ircbpconfig.channels[x]
-        if string.upper(ircbpconfig.channels[x]) == string.upper(CHKCHANNEL):
+        print &quot;The loop is checking if we are in ircbpconfig.channels[&quot; + str(x) + &quot;][0] which is &quot; + ircbpconfig.channels[x][0]
+        if string.upper(ircbpconfig.channels[x][0]) == string.upper(CHKCHANNEL):
             print &quot;We are in it!&quot;
             return 1
         else:
@@ -106,8 +123,8 @@
     x = 0
     print &quot;Starting the loop&quot;
     while (len(ircbpconfig.channels)-1 &gt;= x):
-        print &quot;The loop is checking if the channel is a match @ ircbpconfig.channels[&quot; + str(x) + &quot;] which is &quot; + ircbpconfig.channels[x]
-        if string.upper(ircbpconfig.channels[x]) == string.upper(CHANNEL):
+        print &quot;The loop is checking if the channel is a match @ ircbpconfig.channels[&quot; + str(x) + &quot;][0] which is &quot; + ircbpconfig.channels[x][0]
+        if string.upper(ircbpconfig.channels[x][0]) == string.upper(CHANNEL):
             print &quot;We are in it!&quot;
             del ircbpconfig.channels[x]
             return 1

Modified: bot/trunk/ircbpconfig.py
===================================================================
--- bot/trunk/ircbpconfig.py	2005-01-15 07:52:40 UTC (rev 65)
+++ bot/trunk/ircbpconfig.py	2005-01-15 08:59:52 UTC (rev 66)
@@ -34,7 +34,7 @@
     # EDIT THE FOLLOWING LINE TO THE NAME OF YOUR SQL HOST
     SQLHOST = 'localhost'
     # EDIT THE FOLLOWING LINE TO THE NAME OF YOUR SQL USER
-    SQLUSER = 'IRCBP'
+    SQLUSER = 'IRCBPBOT'
     # EDIT THE FOLLOWING LINE TO THE PASSWORD OF YOUR SQL USER
     SQLPASS = ''
     # EDIT THE FOLLOWING LINE TO THE PORT USED BY YOUR SQL SERVER
@@ -49,7 +49,7 @@
 
 # Connecting...
 
-db=MySQLdb.connect(host=sqlconfig.SQLHOST, user=sqlconfig.SQLUSER, passwd=sqlconfig.SQLPASS, db='IRCBP', port=sqlconfig.SQLPORT)
+db=MySQLdb.connect(host=sqlconfig.SQLHOST, user=sqlconfig.SQLUSER, passwd=sqlconfig.SQLPASS, db='IRCBPBOT', port=sqlconfig.SQLPORT)
 
 # Main configuration!
 
@@ -69,8 +69,7 @@
     print db.errno() + &quot; &quot; + db.error()
     print &quot;Location of error:  Channels Query&quot;
     
-prechannels=db.store_result()
-channels=[c[0] for c in prechannels.fetch_row(prechannels.num_rows())]
+channels=list(db.use_result().fetch_row(500))
 
 # Now from privledged users!
 
@@ -80,10 +79,8 @@
     print db.errno() + &quot; &quot; + db.error()
     print &quot;Location of error:  Users Query&quot;
     
-preprivs=db.store_result()
-privledged=[c[0] for c in preprivs.fetch_row(prechannels.num_rows())]
+privledged=list(db.store_result().fetch_row(500))
 
-
 # Bot Nickname and Realname (Must not be null) for the IRC Bot to use
     
 NICKNAME = configprops[0][0]
@@ -108,5 +105,3 @@
 # 1 if using a IRCd that you are connecting to is DancerIRCd (Freenode for example)
 # 0 if not
 DANCERMODE = int(configprops[0][6])
-
-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000060.html">[ircbp-commits] IRCBP -  r65 - framework/trunk
</A></li>
	<LI>Next message: <A HREF="000062.html">[ircbp-commits] IRCBP -  r67 - bot/trunk framework/trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#61">[ date ]</a>
              <a href="thread.html#61">[ thread ]</a>
              <a href="subject.html#61">[ subject ]</a>
              <a href="author.html#61">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/ircbp-commits">More information about the ircbp-commits
mailing list</a><br>
</body></html>
